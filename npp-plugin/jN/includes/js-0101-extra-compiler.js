(function(k,u){function n(k,n,v){var r=/\s|\u0011|\u0012/,l=/\u0011|\u0012/g,s=/^(\w|[\$@\u0011\u0012])$/,t=n({init:function(a){this.originalCode=a;a=this.literalParser=new v(a);a.parse();this.code=a.code},members:{compile:function(){var a=this.code,a=this.compileLambdas(a),a=a.replace(/@(\u0011|\u0012)?(\w|\$)/g,"this.$1$2").replace(/@/g,"this"),a=this.compileSharp(a);return this.literalParser.restore(a)},compileLambdas:function(a){for(var c=/[^-]->|[^=]=>/g,g=0,b,d="";b=c.exec(a);)if(!(e&&b.index<
e.end)){b=b.index;var f=this.getLeft(a,b),e=this.getRight(a,b+3,f.defaults);e.data=this.compileLambdas(e.data);-1!==a.slice(f.end+1,e.start).indexOf("\u0011")&&(e.data="\u0011"+e.data);-1!==a.slice(f.end+1,e.start).indexOf("\u0012")&&(e.data="\u0012"+e.data);var h="function "+f.name+f.data+" "+e.data;"="===a[b+1]&&(h="("+h+").bind(this)");d+=a.slice(g,f.start)+h;g=e.end+1}return d+=a.slice(g)},getLeft:function(a,c){for(;r.test(a[c])&&(!l.test(a[c])||!s.test(a[c-1]));)--c;var g={end:c,name:"",defaults:""};
if(")"===a[c]){for(var b=1;0<b;){--c;var d=a[c];")"===d?++b:"("===d&&--b}g.start=c;b=a.slice(c+1,g.end);b=this.parseParameters(b);g.data=b.data;g.defaults=b.defaults;for(b=c;0<=c-1&&s.test(a[c-1]);)--c;b=a.slice(c,b);""!==b.replace(l,"")&&(g.start=c,g.name=b)}else{for(;s.test(a[c]);)--c;++c;g.start=c;b=a.slice(c,g.end+1);b=this.parseParameters(b);g.data=b.data;g.defaults=b.defaults}return g},getRight:function(a,c,g){for(;r.test(a[c])&&(!l.test(a[c])||!s.test(a[c+1]));)++c;var b={start:c};if("{"===
a[c]){for(var d=1;0<d;){++c;var f=a[c];"{"===f?++d:"}"===f&&--d}b.end=c;a=a.slice(b.start,c+1);b.data=a}else{for(var e=/\(|\{|\[/,h=/\)|\}|\]/,m=/;|,/,d=0;;){f=a[c];if(0===d&&(h.test(f)||m.test(f))){--c;break}e.test(f)?++d:h.test(f)&&--d;++c}for(d=/\s/;d.test(a[c]);)--c;b.end=c;b.data="{ return "+a.slice(b.start,c+1)+"; }"}g&&(b.data=b.data.replace(/^\{/,"{ "+g));return b},parseParameters:function(a){for(var c={data:"",defaults:""},g=a.length,b=0,d=[];b<g;){for(;r.test(a[b]);)++b;if(b>=g)break;l.test(a[b-
1])&&--b;for(var f=b,e=b,h="";s.test(a[e])&&!(e>=g);)++e;f=a.slice(f,e);b=f.replace(l,"");if(""===b)break;"@"===b[0]&&(h=b+" = "+b.slice(1)+"; ",f=f.replace("@",""));d.push(f);for(b=e;r.test(a[b]);)++b;if("="===a[b]){for(++b;r.test(a[b]);)++b;for(var e=b,m=0;;){var p=a[b];if(0===m&&(","===p||p===u))break;"("===p?++m:")"===p&&--m;++b}e=a.slice(e,b);c.defaults+="if ("+f+" === undefined) { "+f+" = "+e+"; } "}c.defaults+=h;++b}c.data="("+d.join(", ")+")";return c},compileSharp:function(a){for(var c,g=
/#((\w|\u0011|\u0012)*)/g;c=g.exec(a);){var b=c[1].replace(l,""),d=c.index+c[0].length;if("module"===b){for(;r.test(a[d]);)++d;for(var b=d,d=a.indexOf("(",d),b=a.slice(b,d).trim(),f=a.indexOf(")",d),e=[],h=[],m=[],p=a.slice(d+1,f).split(","),k=0;k<p.length;++k){var q=p[k].split("=");if(2<=q.length){var d=q[0].replace(l,"").trim(),n=q[1].replace(l,"").trim();2<q.length&&(q=q[2].replace(l,"").trim(),m.push(q));e.push(d);h.push(n)}}a=a.slice(0,c.index)+'(function (global, undefined) {\n"use strict";\nfunction definition('+
e.join(", ")+") {"+a.slice(f+1)+'}\nif (typeof module === "object" && module.exports) {\nmodule.exports = definition('+(h.length?"require("+h.join("), require(")+")":"")+');\n}\nelse if (typeof define === "function" && define.amd) {\ndefine(['+h.join(", ")+"], definition);\n}\n"+(""!==b?"else {\nglobal."+b+" = definition("+(m.length?"global."+m.join(", global."):"")+");\n}\n":"")+"})(this);"}else"export"===b?a=a.slice(0,c.index)+"return"+a.slice(d):"super"===b&&("("===a[d]?a=a.slice(0,c.index)+t.superInit+
a.slice(d):"."===a[d]?(b=a.indexOf("(",d),d=a.slice(d+1,b),a=a.slice(0,c.index)+t.superCall(d)+a.slice(b+1)):a=a.slice(0,c.index)+t.superConstructor+a.slice(d))}return a}},statics:{superInit:"this.superInit",superCall:function(a){return'this.superCall("'+a+'", '},superConstructor:"this.superConstructor"}});return t}"object"===typeof module&&module.exports?module.exports=n(require("legio/std"),require("legio/oop/construct"),require("./literal-parser")):"function"===typeof define&&define.amd?define(["legio/std",
"legio/oop/construct","./literal-parser"],n):k.ExtraCompiler=n(k.Legio,k.Legio.construct,k.LiteralParser)})(Global.get);
Global.unpack();
