(function(k,m){function h(k,h){var n=/\s|\u0011|\u0012/,l=/\u0011|\u0012/g;return h({init:function(b){this.originalCode=this.code=b;this.literals=[]},members:{parse:function(){var b=this.code,f=0,g=['"',"'","`","/"];a:for(;;){for(var a=Infinity,c,e=0;e<g.length;++e){var d=b.indexOf(g[e],f);-1!==d&&d<a&&(a=d,c=g[e])}if(Number.isFinite(a))if('"'===c||"'"===c||"`"===c)d=this.findNext(c,a+1,!0),-1===d&&this.error(a),f=a+this.putId("string-"+("`"===c?"expanso":'"'===c?"double":"single"),a,d),b=this.code;
else{if("/"===c){if("/"===this.get(a+1))d=this.findNext("\n",a+2),-1===d?d=b.length-1:("\r"===this.get(d-1)&&--d,--d),f=a+this.putId("comment-line",a,d);else if("*"===this.get(a+1))d=this.findNext("*/",a+2),-1===d&&this.error(a),f=a+this.putId("comment-block",a,d+1);else{f=/\)|\]|\w|\$/;for(d=1;0<=a-d;++d)if(e=this.get(a-d),!n.test(e)){if(f.test(e)){f=a+1;continue a}break}d=this.findNext("/",a+1,!0);-1===d&&this.error(a);for(b=/^(g|i|m)/;b.test(this.get(d+1));)++d;b="regexp";"#"===this.get(a-1)?(b+=
"-expanso",a-=1):l.test(this.get(a-1))&&"#"===this.get(a-2)&&(b+="-expanso",a-=2);f=a+this.putId(b,a,d)}b=this.code}}else break}return b},restore:function(b){b===m&&(b=this.code);for(var f=this.literals,g="",a=0;;){for(var c=Infinity,e,d,h,k=0;k<f.length;++k)h="'"+k+'"',e=b.indexOf(h,a),-1!==e&&e<c&&(c=e,d=k);if(Infinity===c)break;h="'"+d+'"';e=c;g+=b.slice(a,e)+f[d].data;a=e+h.length}return g+=b.slice(a)},get:function(b){return this.code[b]},findNext:function(b,f,g){for(var a=-1;;){a=this.code.indexOf(b,
f);if(-1===a)break;if(g){f=0;for(var c=1;;++c){var e=this.get(a-c);if(!l.test(e))if("\\"===e)++f;else break}if(0!==f%2){f=a+1;continue}}break}return a},putId:function(b,f,g){++g;var a=this.code,c=a.slice(f,g);if("regexp-expanso"===b)c=c.slice(1);else if("string-expanso"===b)var c=c.slice(1,-1).replace(l,"").replace(/\\`/g,"`"),e=f-a.lastIndexOf("\n",f)-1,c=c.replace(RegExp("^( ){"+e+"}","gm"),"").trim(),c=JSON.stringify(c),e=c[0],c=c.replace(/#\{@((\w|\$)+)\}/g,e+" + this.$1 + "+e).replace(/#\{((\w|\$)+)\}/g,
e+" + $1 + "+e);b="'"+(this.literals.push({type:b,data:c})-1)+'"';this.code=a.slice(0,f)+b+a.slice(g);return b.length},error:function(b){throw"Parse error starting in position "+b+"!\n"+this.code.substr(b,30)+"\u2026";}}})}"object"===typeof module&&module.exports?module.exports=h(require("legio/std"),require("legio/oop/construct")):"function"===typeof define&&define.amd?define(["legio/std","legio/oop/construct"],h):k.LiteralParser=h(k.Legio,k.Legio.construct)})(this);